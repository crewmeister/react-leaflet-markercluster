"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function isArraysEqual(e,r){return JSON.stringify(e)===JSON.stringify(r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_reactLeaflet=require("react-leaflet"),_leaflet=require("leaflet"),_leaflet2=_interopRequireDefault(_leaflet);require("leaflet.markercluster");var MarkerClusterGroup=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,_reactLeaflet.LayerGroup),_createClass(r,[{key:"componentWillMount",value:function(){this.leafletElement=_leaflet2.default.markerClusterGroup(this.props.options),this.props.markers.length&&this.addLayersWithMarkersFromProps(this.props.markers),this.props.wrapperOptions.enableDefaultStyle&&(this.context.map._container.className+=" marker-cluster-styled"),!this.props.wrapperOptions.disableDefaultAnimation&&(this.context.map._container.className+=" marker-cluster-animated"),this.initEventListeners(this.leafletElement)}},{key:"componentWillReceiveProps",value:function(e){e.markers.length&&!isArraysEqual(this.props.markers,e.markers)&&(this.layerContainer.removeLayer(this.leafletElement),this.leafletElement.clearLayers(),this.addLayersWithMarkersFromProps(e.markers))}},{key:"removeMarkersWithSameCoordinates",value:function(e){var r=[e[0]];return e.forEach(function(e){JSON.stringify(r).includes(JSON.stringify(e))||r.push(e)}),r}},{key:"addLayersWithMarkersFromProps",value:function(e){var r=this.props.markerOptions?Object.assign({},this.props.markerOptions):{},t=[];(this.props.wrapperOptions.removeDuplicates?this.removeMarkersWithSameCoordinates(e):e).forEach(function(e){var a=e.options?Object.assign({},e.options):null,o=_leaflet2.default.marker([e.lat,e.lng],a||r);e.popup&&o.bindPopup(e.popup),e.tooltip&&o.bindTooltip(e.tooltip),t.push(o)}),this.leafletElement.addLayers(t),!this.props.children&&this.layerContainer.addLayer(this.leafletElement)}},{key:"initEventListeners",value:function(e){var r=this;this.props.onMarkerClick&&e.on("click",function(e){r.props.onMarkerClick(e.layer)}),this.props.onClusterClick&&e.on("clusterclick",function(e){r.props.onClusterClick(e.layer)}),this.props.onPopupClose&&e.on("popupclose",function(e){r.props.onPopupClose(e.popup)})}},{key:"addLayersWithReactLeafletMarkers",value:function(){var e=this,r=[];return _react.Children.map(this.props.children,function(t,a){return(0,_react.cloneElement)(t,{ref:function(t){t&&(r.push(t.leafletElement),a!==e.props.children.length-1&&Array.isArray(e.props.children)||(e.leafletElement.addLayers(r),e.layerContainer.addLayer(e.leafletElement)))},key:"react-leaflet-marker-"+a})})}},{key:"getLeafletElement",value:function(){return this.leafletElement}},{key:"render",value:function(){return this.props.children?_react2.default.createElement("section",{className:"marker-cluster-group"},this.addLayersWithReactLeafletMarkers()):null}}]),r}();exports.default=MarkerClusterGroup,MarkerClusterGroup.propTypes={markers:_propTypes2.default.arrayOf(_propTypes2.default.object),children:_propTypes2.default.node,options:_propTypes2.default.object,markerOptions:_propTypes2.default.object,wrapperOptions:_propTypes2.default.object,onMarkerClick:_propTypes2.default.func,onClusterClick:_propTypes2.default.func,onPopupClose:_propTypes2.default.func},MarkerClusterGroup.defaultProps={markers:[],wrapperOptions:{}};